<app-header></app-header>

<!-- Bot√≥n toggle que solo aparece cuando el sidebar est√° oculto -->
  <app-sidebar-toggle-button></app-sidebar-toggle-button>


<div class="page-with-sidebar">
  
   <!-- Sidebar -->
  <aside class="quick-access-sidebar">
    <app-accesos-rapidos-admi></app-accesos-rapidos-admi>
  </aside>

  <!-- Main Content -->
  <main class="content">
    <!-- Page Title -->
    <div class="page-header">
      <h1 class="titulo-pagina">Usuarios Registrados</h1>
      <div class="hr-line"></div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <span class="stat-number">{{ getTotalUsersCount() }}</span>
          <span class="stat-label">Total Usuarios</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üë©‚Äçüè´</div>
        <div class="stat-info">
          <span class="stat-number">{{ getUserCountByRole("ROLE_TEACHER") }}</span>
          <span class="stat-label">Docentes</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üëî</div>
        <div class="stat-info">
          <span class="stat-number">{{ getUserCountByRole("ROLE_USER") }}</span>
          <span class="stat-label">Jefes de Secci√≥n</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚öôÔ∏è</div>
        <div class="stat-info">
          <span class="stat-number">{{ getUserCountByRole("ROLE_ADMIN") }}</span>
          <span class="stat-label">Administradores</span>
        </div>
      </div>
    </div>

    <!-- Filters Section (style similar to planificacion) -->
    <div class="filters-container">
      <!-- Search Bar -->
      <div class="filter-group">
        <label class="filter-label" for="search-input">Buscar:</label>
        <input 
          id="search-input"
          [(ngModel)]="searchText" 
          (ngModelChange)="applyFilters()" 
          placeholder="Buscar por nombre, email, documento..." 
          class="search-bar">
      </div>
      
      <!-- Role Filter -->
      <div class="filter-group">
        <label class="filter-label" for="role-select">Filtrar por Rol:</label>
        <select 
          id="role-select" 
          [(ngModel)]="roleFilter" 
          (ngModelChange)="applyFilters()" 
          class="filter-select">
          <option value="">Todos los roles</option>
          <option *ngFor="let option of roleOptions" [value]="option.id">
            {{ option.name }} ({{ option.count }})
          </option>
        </select>
      </div>
      
      <!-- Faculty Filter -->
      <div class="filter-group">
        <label class="filter-label" for="faculty-select">Filtrar por Facultad:</label>
                <select 
          class="form-select"
          name="section" 
          [(ngModel)]="sectionFilter" 
          [disabled]="!sectionOptions.length">
          <option value="">Todas las secciones</option>
          @for (option of sectionOptions; track option.id) {
            <option [value]="option.id">
              {{ option.name }} ({{ option.count }})
            </option>
          }
        </select>
      </div>

      <!-- Status Filter -->
      <div class="filter-group">
        <label class="filter-label" for="status-select">Filtrar por Estado:</label>
        <select 
          id="status-select" 
          [(ngModel)]="statusFilter" 
          (ngModelChange)="applyFilters()" 
          class="filter-select">
          <option value="">Todos los estados</option>
          <option *ngFor="let option of statusOptions" [value]="option.id">
            {{ option.name }} ({{ option.count }})
          </option>
        </select>
      </div>

      <!-- Clear Filters Button -->
      <div class="filter-actions">
        <button 
          class="btn btn-clear" 
          (click)="clearFilters()"
          [disabled]="!searchText && !roleFilter && !sectionFilter && !statusFilter">
          üóëÔ∏è Limpiar Filtros
        </button>
      </div>
    </div>

    <!-- Results Info -->
    <div class="results-info">
      <p *ngIf="!loading">
        Mostrando {{ getFilteredUsersCount() }} de {{ getTotalUsersCount() }} usuarios
        <span *ngIf="getFilteredUsersCount() !== getTotalUsersCount()">
          (filtrados)
        </span>
      </p>
    </div>

    <!-- Users Cards Section -->
    <div class="users-grid" *ngIf="!loading">
      <app-user-card-container
        *ngFor="let user of filteredUsers; trackBy: trackByUserId"
        [user]="user"
        [actions]="cardActions"
        [showActions]="false"
        [loading]="false"
        (userSelected)="onUserSelected($event)"
        (editUser)="onEditUser($event)"
        (deleteUser)="onDeleteUser($event)">
      </app-user-card-container>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <div class="loading-spinner"></div>
      <p>Cargando usuarios...</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && filteredUsers.length === 0">
      <div class="empty-icon">üì≠</div>
      <h3>No se encontraron usuarios</h3>
      <p *ngIf="allUsers.length === 0">
        No hay usuarios registrados en el sistema.
      </p>
      <p *ngIf="allUsers.length > 0">
        No hay usuarios que coincidan con los filtros aplicados.
      </p>
      <button class="btn btn--primary" (click)="clearFilters()" *ngIf="allUsers.length > 0">
        Limpiar filtros
      </button>
    </div>


  </main>
</div>
