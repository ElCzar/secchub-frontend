<app-header></app-header>

<div class="page-container">
  <header class="page-head">
    <h1 class="titulo-pagina">Formulario para Programas</h1>
    <div class="hr-line"></div>

    <!-- Contexto cargado desde backend -->
    @if (context$ | async; as ctx) {
      <div class="meta">
        <span><strong>ID Carrera:</strong> {{ ctx.careerId }}</span>
        <span><strong>Carrera:</strong> {{ ctx.careerName }}</span>
        <span><strong>Semestre:</strong> {{ ctx.semester }}</span>
      </div>
    } @else {
      <!-- Placeholder mientras carga -->
      <div class="meta">
        <span><strong>ID Carrera:</strong> …</span>
        <span><strong>Carrera:</strong> …</span>
        <span><strong>Semestre:</strong> …</span>
      </div>
    }

    <!-- Contador de clases (solo front) -->
    <div class="meta">
      <span><strong>Número total de clases a inscribir:</strong> {{ totalCount }}</span>
    </div>

    <!-- Botones de acciones alineados a la derecha -->
    <div class="actions actions--right">
      <button 
        type="button" 
        class="btn btn--secondary" 
        [disabled]="loadingPrevious"
        (click)="loadPrevious()">
        @if (!loadingPrevious) {
          <span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            Duplicar Solicitudes
          </span>
        } @else {
          <span>
            <svg class="loading-spinner" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12a9 9 0 11-6.219-8.56"/>
            </svg>
            Cargando...
          </span>
        }
      </button>
    </div>
  </header>

  <section class="tabla-placeholder">
    <app-classes-table
    [rows]="rows"
    (add)="addRow()"
    (remove)="removeRow($event)"
    (patch)="onPatch($event)">
  </app-classes-table>

</section>




<!-- Botón Enviar al final del formulario -->
<div class="actions actions--right actions--enviar">
  <button
    type="button"
    class="btn btn--primary"
    [disabled]="!isFormValid()"
    (click)="showConfirm = true">
    Enviar
  </button>
</div>

<!-- Popup de confirmación reutilizable -->
<app-confirm-send-popup
  [visible]="showConfirm"
  (confirm)="onConfirmSend()"
  (decline)="showConfirm = false">
</app-confirm-send-popup>

<!-- Modal de duplicación de solicitudes -->
@if (showDuplicateModal) {
  <app-pop-duplicacion-solicitud
    (closeModal)="closeDuplicateModal()"
    (applySemester)="onApplyDuplicatedRequests($event)">
  </app-pop-duplicacion-solicitud>
}

</div>
