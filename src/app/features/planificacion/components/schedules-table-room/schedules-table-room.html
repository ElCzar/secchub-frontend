<div class="sched-wrap">
  <div class="sched-head">
    <span class="title">Horarios</span>
  </div>

  <div class="sched-table">
    <div class="sched-row sched-row--head">
      <div style="width:92px;">Acciones</div>
      <div>Día</div>
      <div>Hora Inicio</div>
      <div>Hora Final</div>
      <div>Tipo de salón</div>
      <div>Discapacidad</div>
      <div>Modalidad</div>
      <div>Salón</div>
    </div>

    <div class="sched-row" *ngFor="let r of rows; let i = index; trackBy: trackByFn">
      <!-- Acciones -->
      <div class="actions">
        <button class="btn-icon" type="button" (click)="remove(i)" [disabled]="!editable" title="Eliminar horario">−</button>
        <button class="btn-icon" type="button" (click)="addNewSchedule()" [disabled]="!editable" title="Agregar horario">+</button>
      </div>

      <!-- Día -->
      <div>
        <select class="input" [ngModel]="r.day" (ngModelChange)="patch(i,{day:$event})" [disabled]="!editable">
          <option [ngValue]="undefined">Seleccione…</option>
          <option *ngFor="let d of days" [ngValue]="d.v">{{ d.t }}</option>
        </select>
      </div>

      <!-- Hora inicio -->
      <div class="time-cell">
        <input #ti type="time" class="input" [ngModel]="r.startTime" (ngModelChange)="patch(i,{startTime:$event})" [disabled]="!editable">

      </div>

      <!-- Hora final -->
      <div class="time-cell">
        <input #tf type="time" class="input" [ngModel]="r.endTime" (ngModelChange)="patch(i,{endTime:$event})" [disabled]="!editable">
    
      </div>

      <!-- Tipo salón -->
      <div>
        <select class="input" [ngModel]="r.roomType" (ngModelChange)="patch(i,{roomType:$event})" [disabled]="!editable || r.modality === 'Online'">
          <option [ngValue]="undefined">Seleccionar tipo...</option>
          <option *ngFor="let t of roomTypes" [value]="t">
            {{ roomTypeDisplayNames[t] || t }}
          </option>
        </select>
        <small style="color: #777; font-size: 10px;">Valor interno: {{ r.roomType }}</small>
      </div>

      <!-- Discapacidad -->
      <div class="radio">
        <label><input type="radio" [checked]="r.disability" (change)="patch(i,{disability:true})" [disabled]="!editable"> Sí</label>
        <label><input type="radio" [checked]="!r.disability" (change)="patch(i,{disability:false})" [disabled]="!editable"> No</label>
      </div>

      <!-- Modalidad -->
      <div>
        <select class="input" [ngModel]="r.modality" (ngModelChange)="onModalityChange(i, $event)" [disabled]="!editable">
          <option *ngFor="let m of modalities_local" [value]="m">
            {{ modalityDisplayNames[m] || m }}
          </option>
        </select>
        <small style="color: #777; font-size: 10px;">Valor interno: {{ r.modality }}</small>
      </div>

      <!-- Salón -->
      <div>
        <ng-container *ngIf="classrooms.length > 0; else fallbackRoomInput">
          <select class="input" [ngModel]="getSimpleRoomName(r.room)" (ngModelChange)="onRoomChange(i, $event)" [disabled]="!editable || r.modality === 'Online'">
            <option value="">Seleccionar aula...</option>
            <option *ngFor="let classroom of classrooms" [value]="classroom.name">
              {{ classroom.name }} ({{ classroom.building }}, Cap: {{ classroom.capacity }})
            </option>
          </select>
          <small style="color: #777; font-size: 10px;" *ngIf="r.classroomId">ID: {{ r.classroomId }}</small>
        </ng-container>
        <ng-template #fallbackRoomInput>
          <input class="input" placeholder="Ej: A-203" [ngModel]="r.room" (ngModelChange)="patch(i,{room:$event})" [disabled]="!editable || r.modality === 'Online'"/>
        </ng-template>
        <small *ngIf="r.modality === 'Online'" class="text-muted">No se requiere aula para modalidad online</small>
      </div>
    </div>
  </div>
</div>
