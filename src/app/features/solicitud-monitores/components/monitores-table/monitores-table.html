<div class="table-container">
  <table class="monitores-table">
    <thead>
      <tr>
        <th class="approval-column">Acciones</th>
        <th>ID del<br>estudiante</th>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Carrera</th>
        <th>Semestre</th>
        <th>Promedio<br>Acumulado</th>
        @if (!adminMode) {
          <th>Nombre del profesor<br>con quien tomó<br>la asignatura</th>
        }
        @if (!adminMode) {
          <th>No.<br>Clase</th>
        }
        @if (!adminMode) {
          <th>Nombre<br>Asignatura</th>
        }
        @if (!adminMode) {
          <th>Nota<br>Obtenida</th>
        }
        @if (adminMode) {
          <th>Sección<br>Académica</th>
        }
        <th>Horas<br>Semanales</th>
        <th>Semanas</th>
        <th>Total<br>Horas</th>
        <th>Correo<br>Institucional</th>
        <th>ANTIGUO</th>
        @if (showMonitorAdministrativo) {
          <th>Monitor<br>Administrativo</th>
        }
      </tr>
    </thead>
    <tbody>
      @for (m of monitores; track m.id; let i = $index) {
        <tr class="monitor-row" [ngClass]="{ 'row-accepted': m.estado === 'aceptado', 'row-rejected': m.estado === 'rechazado' }">
          <td class="approval-column">
            <div class="row-approval">
              <button type="button" class="btn-approve" (click)="aceptarMonitor(m)" title="Aceptar">✓</button>
              <button type="button" class="btn-reject" (click)="rechazarMonitor(m)" title="Rechazar">✕</button>
            </div>
          </td>
          <td>{{ m.id }}</td>
          <td>{{ m.nombre }}</td>
          <td>{{ m.apellido }}</td>
          <td>{{ m.carrera }}</td>
          <td>{{ m.semestre }}</td>
          <td>{{ m.promedio }}</td>
          @if (!adminMode) {
            <td>{{ m.profesor }}</td>
          }
          @if (!adminMode) {
            <td class="editable-cell">
              <input 
                type="number" 
                class="table-input" 
                [(ngModel)]="m.noClase" 
                placeholder=""
              />
            </td>
          }
          @if (!adminMode) {
            <td>{{ m.asignatura }}</td>
          }
          @if (!adminMode) {
            <td>{{ m.nota }}</td>
          }
          @if (adminMode) {
            <td>{{ m.seccionAcademica || '-' }}</td>
          }
          <td class="editable-cell">
            <input 
              type="number" 
              class="table-input" 
              [(ngModel)]="m.horasSemanales" 
              (change)="calcularTotal(m)" 
              placeholder=""
            />
          </td>
          <td class="editable-cell">
            <input 
              type="number" 
              class="table-input" 
              [(ngModel)]="m.semanas" 
              (change)="calcularTotal(m)" 
              placeholder=""
            />
          </td>
          <td class="total-horas">{{ m.totalHoras }}</td>
          <td>{{ m.correo }}</td>
          <td>{{ m.antiguo ? 'Sí' : 'No' }}</td>
          @if (showMonitorAdministrativo) {
            <td>{{ m.administrativo ? 'Sí' : 'No' }}</td>
          }
          
        </tr>

        <!-- Expander para horarios -->
        <tr class="expander-row" [ngClass]="{ 'row-accepted': m.estado === 'aceptado', 'row-rejected': m.estado === 'rechazado' }">
          <td [attr.colspan]="getColspan()">
            <div class="expander-inner">
              <button class="expander" type="button" (click)="m.showHorarios = !m.showHorarios">
                <span class="caret" [class.open]="m.showHorarios">▸</span> Horarios
              </button>
            </div>
          </td>
        </tr>

        <!-- Bloque de horarios (solo si showHorarios) -->
        @if (m.showHorarios) {
          <tr [ngClass]="{ 'row-accepted': m.estado === 'aceptado', 'row-rejected': m.estado === 'rechazado' }">
            <td [attr.colspan]="getColspan()">
              <app-horarios-monitores [horarios]="m.horarios || []"></app-horarios-monitores>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>
</div>
