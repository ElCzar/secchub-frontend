<!-- Confirmation Modal -->
<app-confirmation-teachers
  [showModal]="showConfirmationModal"
  [selectedDocentes]="selectedDocentes"
  (modalClosed)="onConfirmationClosed()"
  (cancelSelection)="onCancelSelection()"
  (addAnotherTeacher)="onAddAnotherTeacher()"
  (continueToPlanning)="onContinueToPlanning($event)">
</app-confirmation-teachers>

<!-- Hour Warning Modal -->
<app-hour-limit-warning
  [showModal]="showHourWarningModal"
  [docente]="docente"
  [workHoursToAssign]="workHoursToAssign"
  (modalClosed)="onHourWarningClosed()"
  (confirmAssignment)="onHourWarningConfirmed()"
  (cancelAssignment)="onHourWarningCancelled()">
</app-hour-limit-warning>

<!-- Extra Hours Warning Modal (debe ir al final para sobrescribir el resto) -->
<div class="modal-overlay extra-warning" *ngIf="showExtraWarningModal" (click)="onExtraWarningCancel()" (keydown.escape)="onExtraWarningCancel()">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Advertencia de horas extra</h2>
      <button class="modal-close" (click)="onExtraWarningCancel()">&times;</button>
    </div>
    <div class="modal-body">
      <p>
        El docente <b>{{ docente?.name }}</b> excede su límite de horas (<b>{{ extraWarningData?.maxHours }}</b> horas).
        <br>
        Horas asignadas actualmente: <b>{{ extraWarningData?.currentSum }}</b>.<br>
        Horas a asignar: <b>{{ workHoursToAssign }}</b>.<br>
        <span style="color: #d9534f; font-weight: bold;">Exceso: {{ extraWarningData?.excessHours }} horas.</span>
      </p>
      <p>
        Si acepta, las horas excedentes serán pagadas como <b>horas extra cátedra</b>.
      </p>
      <div style="text-align:center; margin: 18px 0 0 0; font-size: 1.1em; font-weight: 500;">
        ¿Desea continuar?
      </div>
      <div class="actions-section">
        <button type="button" class="btn btn--primary" (click)="onExtraWarningAccept()">Aceptar</button>
        <button type="button" class="btn btn--secondary" (click)="onExtraWarningCancel()">Cancelar</button>
      </div>
    </div>
  </div>
</div>
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()" (keydown.escape)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">{{ docente?.name }}</h2>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>

    <div class="modal-body">
      <!-- Tabla de materias y horarios -->
      <div class="classes-table-container" *ngIf="hasClasses">
        <table class="classes-table">
          <thead>
            <tr>
              <th>Materia</th>
              <th>Sección</th>
              <th>Semestre</th>
              <th>Horarios</th>
              <th>N°Clases</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let clase of clases">
              <td>{{ clase.materia }}</td>
              <td>{{ clase.seccion }}</td>
              <td>{{ clase.semestre }}</td>
              <td>
                <div class="horarios">
                  <div *ngFor="let horario of clase.horarios">{{ horario }}</div>
                </div>
              </td>
              <td>{{ clase.numeroClases }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Botón Agregar -->
      <div class="actions-section">
        <button type="button" class="btn btn--primary agregar-btn" (click)="selectDocente()">
          Agregar
        </button>
      </div>

      <!-- Sección de Observaciones -->
      <div class="observaciones-section">
        <h3 class="observaciones-title">OBSERVACIONES:</h3>
        
        <!-- Lista de observaciones existentes -->
        <div class="observaciones-list" *ngIf="hasObservaciones">
          <div class="observacion-item" *ngFor="let observacion of observaciones; let i = index">
            <p>{{ observacion }}</p>
            <button type="button" class="btn-remove" (click)="eliminarObservacion(i)" title="Eliminar observación">×</button>
          </div>
        </div>

        <!-- Campo para agregar nueva observación -->
        <div class="nueva-observacion">
          <textarea 
            [(ngModel)]="nuevaObservacion"
            placeholder="Escribir nueva observación..."
            class="observacion-textarea"
            rows="3">
          </textarea>
          <button 
            type="button" 
            class="btn btn--primary" 
            (click)="agregarObservacion()"
            [disabled]="!nuevaObservacion.trim()">
            Añadir Observacion
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<app-confirmation-teachers
  [showModal]="showConfirmationModal"
  [selectedDocentes]="selectedDocentes"
  (modalClosed)="onConfirmationClosed()"
  (cancelSelection)="onCancelSelection()"
  (addAnotherTeacher)="onAddAnotherTeacher()"
  (continueToPlanning)="onContinueToPlanning($event)">
</app-confirmation-teachers>

<!-- Hour Warning Modal -->
<app-hour-limit-warning
  [showModal]="showHourWarningModal"
  [docente]="docente"
  [workHoursToAssign]="workHoursToAssign"
  (modalClosed)="onHourWarningClosed()"
  (confirmAssignment)="onHourWarningConfirmed()"
  (cancelAssignment)="onHourWarningCancelled()">
</app-hour-limit-warning>
