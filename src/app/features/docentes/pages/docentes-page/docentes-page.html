<app-header></app-header>

<!-- Bot√≥n toggle que solo aparece cuando el sidebar est√° oculto -->
<app-sidebar-toggle-button></app-sidebar-toggle-button>

<!-- Sidebar fijo -->
<aside class="sidebar">
    @if (isAdministrator()) {
        <app-accesos-rapidos-admi></app-accesos-rapidos-admi>
    }
    @else {
        <app-accesos-rapidos-seccion></app-accesos-rapidos-seccion>
    }
</aside>

<div class="docentes-page">
  <!-- Contenido principal -->
  <div class="main-content">
    <h1 class="titulo-pagina">Docentes</h1>
    <div class="hr-line"></div>

    <!-- Filtros -->
    <div class="filters-container">
      <div class="filter-group">
        <label class="filter-label" for="search-input">Buscar:</label>
        <input 
          id="search-input"
          [(ngModel)]="searchText" 
          (ngModelChange)="filterDocentes()" 
          [disabled]="isLoading"
          placeholder="Buscar docente..." 
          class="search-bar">
      </div>
      
      <div class="filter-group">
        <label class="filter-label" for="subject-select">Filtrar por materia:</label>
        <select 
          id="subject-select" 
          [(ngModel)]="subjectFilter" 
          (ngModelChange)="applyFilters()" 
          [disabled]="isLoading"
          class="filter-select">
          <option value="">Todas las materias</option>
          <option *ngFor="let subject of subjects" [value]="subject">{{subject}}</option>
        </select>
      </div>

      <!-- Bot√≥n de recarga -->
      <div class="filter-group">
        <button 
          (click)="reloadTeachers()" 
          [disabled]="isLoading"
          class="reload-button"
          title="Recargar docentes">
          <span *ngIf="!isLoading">üîÑ</span>
          <span *ngIf="isLoading">‚è≥</span>
          Recargar
        </button>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="loadError" class="error-message">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span class="error-text">{{ loadError }}</span>
      <button (click)="reloadTeachers()" class="retry-button">Reintentar</button>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Cargando docentes...</p>
    </div>

    <!-- Grid de docentes -->
    <div *ngIf="!isLoading && !loadError" class="docentes-grid">
      <div *ngIf="filteredDocentes.length === 0" class="no-results">
        <span class="no-results-icon">üîç</span>
        <p class="no-results-text">No se encontraron docentes con los criterios seleccionados.</p>
        <button (click)="reloadTeachers()" class="retry-button">Recargar docentes</button>
      </div>
      
      <app-docente-card
        *ngFor="let docente of filteredDocentes"
        [docente]="docente"
        (selected)="selectDocente($event)"
      ></app-docente-card>
    </div>
  </div>
</div>

<!-- Modal detallado de informaci√≥n del profesor -->
<app-teacher-select-modal
    [docente]="selectedDocenteInfo"
    [showModal]="showModal"
    [classKey]="classKey"
    [classInfo]="classInfo"
    (modalClosed)="closeModal()"
    (docenteSelected)="onDocenteSelected($event)">
</app-teacher-select-modal>

<!-- Modal de selecci√≥n de fechas para el profesor -->
<app-teacher-dates-modal
    [isVisible]="showDatesModal"
    [data]="datePopupData"
    (datesSelected)="onTeacherDatesSelected($event)"
    (modalClosed)="closeDatesModal()">
</app-teacher-dates-modal>
