<!-- Tabla de materias -->
@if (!loading) {
  <div class="table-container">
    <table class="subjects-table">
    <thead>
      <tr>
        <th>Acciones</th>
        <th>C√≥digo</th>
        <th>Nombre</th>
        <th>Cr√©ditos</th>
        <th>Descripci√≥n</th>
        <th>Estado</th>
        <th>Secci√≥n Administrativa </th>
      </tr>
    </thead>
    <tbody>
      <!-- Fila para nueva materia -->
      @if (isAddingNew) {
        <tr class="table-row new-row">
        <td class="actions-column">
          <button 
            type="button"
            (click)="saveNewCourse()"
            class="action-btn save-btn"
            title="Guardar"
            [disabled]="!validateNewCourse()"
          >
            ‚úÖ
          </button>
          <button 
            type="button"
            (click)="cancelAddingNew()"
            class="action-btn delete-btn"
            title="Cancelar"
          >
            üóëÔ∏è
          </button>
        </td>
        <td>
          <input 
            type="text" 
            [(ngModel)]="newCourse.code"
            placeholder="C√≥digo"
            class="table-input"
          />
        </td>
        <td>
          <input 
            type="text" 
            [(ngModel)]="newCourse.name"
            placeholder="Nombre de la materia"
            class="table-input"
          />
        </td>
        <td>
          <div class="credits-input">
            <button 
              type="button" 
              (click)="decrementCredits()"
              class="credit-btn"
              [disabled]="(newCourse.credits || 0) <= 0"
            >
              -
            </button>
            <input 
              type="number" 
              [(ngModel)]="newCourse.credits"
              min="0"
              max="10"
              class="credit-number"
            />
            <button 
              type="button" 
              (click)="incrementCredits()"
              class="credit-btn"
              [disabled]="(newCourse.credits || 0) >= 10"
            >
              +
            </button>
          </div>
        </td>
        <td>
          <input 
            type="text" 
            [(ngModel)]="newCourse.description"
            placeholder="Descripci√≥n"
            class="table-input"
          />
        </td>
        <td>
          <select [(ngModel)]="newCourse.status" class="table-select">
            @for (option of (statusOptions || []); track option?.value || option) {
              <option [value]="option.value">
                {{ option?.label || 'Sin etiqueta' }}
              </option>
            }
          </select>
        </td>
        <td>
          <select [(ngModel)]="newCourse.sectionId" class="table-select">
            <option value="">Seleccionar secci√≥n</option>
            @for (section of (sections || []); track section?.id || section) {
              <option [value]="section.id">
                {{ section?.name || 'Sin nombre' }}
              </option>
            }
          </select>
        </td>
      </tr>
      }

      <!-- Filas existentes -->
      @for (course of (courses || []); track course?.id || course) {
        <tr class="table-row" [class.editing-row]="course.id && isEditing(course.id)">
        <td class="actions-column">
          <button 
            type="button"
            (click)="editCourse(course)"
            class="action-btn"
            [class.edit-btn]="!course.id || !isEditing(course.id)"
            [class.save-btn]="course.id && isEditing(course.id)"
            [title]="(course.id && isEditing(course.id)) ? 'Guardar' : 'Editar'"
          >
            {{ (course.id && isEditing(course.id)) ? '‚úÖ' : '‚úèÔ∏è' }}
          </button>
          <button 
            type="button"
            (click)="deleteCourse(course)"
            class="action-btn delete-btn"
            title="Eliminar"
          >
            üóëÔ∏è
          </button>
        </td>
        <td>
          <span>{{ course.id || 'N/A' }}</span>
        </td>
        <td>
          @if (!course.id || !isEditing(course.id)) {
            <span>{{ course.name || 'Sin nombre' }}</span>
          } @else {
            <input 
              type="text" 
              [(ngModel)]="course.name"
              class="table-input"
            />
          }
        </td>
        <td>
          @if (!course.id || !isEditing(course.id)) {
            <span>{{ course.credits || 0 }}</span>
          } @else {
            <div class="credits-input">
              <button 
                type="button" 
                (click)="course.credits = (course.credits || 0) > 0 ? (course.credits || 0) - 1 : 0"
                class="credit-btn"
                [disabled]="(course.credits || 0) <= 0"
              >
                -
              </button>
              <input 
                type="number" 
                [(ngModel)]="course.credits"
                min="0"
                max="10"
                class="credit-number"
              />
              <button 
                type="button" 
                (click)="course.credits = (course.credits || 0) < 10 ? (course.credits || 0) + 1 : 10"
                class="credit-btn"
                [disabled]="(course.credits || 0) >= 10"
              >
                +
              </button>
            </div>
          }
        </td>
        <td>
          @if (!course.id || !isEditing(course.id)) {
            <span>{{ course.description || 'Sin descripci√≥n' }}</span>
          } @else {
            <input 
              type="text" 
              [(ngModel)]="course.description"
              class="table-input"
            />
          }
        </td>
        <td>
          @if (!course.id || !isEditing(course.id)) {
            <span [class]="'status-badge ' + (getStatusClass(course) || '')">
              {{ getStatusLabel(course) || 'Sin estado' }}
            </span>
          } @else {
            <select [(ngModel)]="tempEditData.status" class="table-select">
              <option value="">Seleccionar estado</option>
              @for (status of (statusOptions || []); track status?.value || status) {
                <option [value]="status.value">
                  {{ status?.label || 'Sin etiqueta' }}
                </option>
              }
            </select>
          }
        </td>
        <td>
            @if (!course.id || !isEditing(course.id)) {
            <span>{{ course.sectionId ? (obtainSectionNameById(course.sectionId) || 'Secci√≥n desconocida') : 'Sin secci√≥n' }}</span>
            } @else {
            <select [(ngModel)]="tempEditData.sectionId" class="table-select">
              <option value="">Seleccionar secci√≥n</option>
              @for (section of (sections || []); track section?.id || section) {
                <option [value]="section.id">
                {{ section?.name || 'Sin nombre' }}
                </option>
              }
            </select>
          }
        </td>
      </tr>
      }
      
      @if ((courses || []).length === 0) {
        <tr class="no-data-row">
          <td colspan="7" class="no-data">
            No se encontraron materias
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>
} @else {
  <!-- Template de carga -->
  <div class="loading-container">
    <p>Cargando materias...</p>
  </div>
}
